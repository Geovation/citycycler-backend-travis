language: node_js
node_js:
- '6'
cache:
  directories:
  - node_modules
env:
  global:
  - NODE_ENV=staging
  - URL="https://matchmyroute-backend.appspot.com"
  - secure: AGOSLSLbL615LYqTi3NnYnYUAzcPzGwgRzhnUcCp+B3kTpWoos+H+akUS0CUp6wPmwf1GLefz5zoRFJi/CrLeJLTFebxOckwP8epuawkfdHpdecySRepfI3ioHxcpIeg9HZ8lV0WenS93imypVq7oteyLii4uWQRcG0wD1hgr/N9Jwt0+SDG1pR50boNHN3A1zGQkyEizO/X/t2rD9XRLzYHXyAsrEFaSr0b/AxpqqjylY2rr+rhpDsqUVnJ7zRlFlGGWgCh5EnKdZm4PFZ23PEP0V7uXlw41u5q3dMw9qIhhTstQyWkrp9BZ9wP8h8OrhKEqyAovk9C+9q8Lzeg8B83yH2HwzpSKPpaunOB0wkyO/WXEfb+zIC+nmYFQp6oKG25SJOxDEyOsTqWeDmBMHpAWUN3kt7tsjEoUwrG+B6B5ETjduCBLoXQ1PIah1TookjcfW2/8oWSb5TJCoDEcnTPOFhVpRKya3BV52aFXKsdmJ1ofOBxHwYImocQgbV57PLyZzu2NgWrAl9mM9DTbDrKBHOH0Q8dznvGHFBJkGdxzt6Aw4Y/QUznIvaSaGypI/oJA5IeI73SzfOXVNvUPTCiMMqTvLIdSiZdINj1d5ewu4Hao+FwhbcJdu/iZf/ruG8uU3RWE5+0wwRWrBq6VmANttkW76SP20w61bBJ4zc=
before_install:
- openssl aes-256-cbc -K $encrypted_6b1d22c161fd_key -iv $encrypted_6b1d22c161fd_iv
  -in ./conf/key-file.json.enc -out ./conf/key-file.json -d
- openssl aes-256-cbc -K $encrypted_bcb0da9ada9b_key -iv $encrypted_bcb0da9ada9b_iv
  -in ./conf/matchmyroute-backend-firebase-adminsdk-jm5jb-e33eab9419.json.enc -out
  ./conf/matchmyroute-backend-firebase-adminsdk-jm5jb-e33eab9419.json -d
addons:
  postgresql: '9.6'
  apt:
    packages:
    - postgresql-9.6-postgis-2.3
before_script:
- psql -U postgres -c "create extension postgis"
- psql -c "CREATE USER testuser WITH PASSWORD 'test' SUPERUSER;"
- psql -c 'CREATE DATABASE "matchMyRouteTest" WITH OWNER testuser;'
script:
- npm run test
- npm run build
deploy:
  provider: gae
  keyfile: "./conf/key-file.json"
  project: matchmyroute-backend
  config: "./build/app.yaml"
  skip_cleanup: true
after_deploy:
- npm run e2etest
notifications:
  slack:
    secure: TOt8glnjOcUX4kOLQ0sHJhq38Wtmwl1iZM7kbL9931Xa6T8zNkjsPT8phzmovpvEzYvxSzd4w1AymyPGCfpV1qXH5Gxnqw2rdrhcFMZV7jJiFLLHBvXKFjcamS260RKEpSeBz7hK963XD4nkD7YlHIOOebMEgJCr8wxJqgaNFQz90Wgvop/b1GhYp6oI1AeB7CBZYS6RhYcKZsOyuPgCx2YITsxlJt9LKt8Sk7VKxcY+MzJ3nOXl1EIDpkX+TPuRaPH2Z0pFWswoNLMpnrk0uVrBOXqbTKwnNxQulHQy6MefmRx/NHRbWiaehQHmKAP1Pgc8hQImkIWkyNS4TWJ7z23wb5ZY4pg63Ne2LJGGlYBrAL0G7G4nOVrDDcfa/i8NsmZ8Ok93cD9QPk/zYbUhdsfUmLsmn8jESw3K5zbW8OL5XosS3sAucdAwV+yg1eJuEF8DGL/RQI3X68LutR5WalQ6p/LJK8fg2EJshadNNpg2csvo1z1FhHSGJKeax4YMbc5Qrk5VKu72zscEPtSMfZMM+ps/HdoU6LmxPMnWLAfAy9Ms4OIqPGlDO94UGFzGRiY4PSZgRdElAv/Fgr7p8L971vkXOonkiG6j5MI+jWjj1yibvzjcdOW5+ddjfTLmXW+XKa9Oc15Jju5yCFlX5weT+DIffqqePnmTyO4cF3Y=
